{% extends "layout.html" %}

{% block pageTitle %}
GOV.UK Prototype Kit
{% endblock %}

{% block content %}

<div class="govuk-breadcrumbs govuk-!-margin-bottom-5">
    <ol class="govuk-breadcrumbs__list">
        <li class="govuk-breadcrumbs__list-item">
            <a class="govuk-breadcrumbs__link" href="/start.html">Calculate funding</a>
        </li>
        <li class="govuk-breadcrumbs__list-item">
            <a class="govuk-breadcrumbs__link" href="manageData">Manage data</a>
        </li>
        <li class="govuk-breadcrumbs__list-item">
            <a class="govuk-breadcrumbs__link" href="manageDatasets.html">Manage data source files</a>
        </li>
        <li class="govuk-breadcrumbs__list-item" aria-current="page">Update data source file</li>
    </ol>
</div>

<div class="govuk-grid-row">
    <form action="/v1/datasets/manageDatasets" method="post" class="form" id="updateDataset" novalidate
        data-validate='update-data-source'>
        <fieldset class="govuk-fieldset">
            <div class="govuk-grid-column-full">
                <h1 class="govuk-heading-xl govuk-!-margin-bottom-5">Update Lump sum for 2020 to 2021 (version 1)</h1>


            </div>
            <div class="govuk-grid-column-full govuk-!-margin-top-5">

                <dl class="govuk-summary-list govuk-summary-list--no-border">
                    <div class="govuk-summary-list__row">
                        <dt class="govuk-summary-list__key">
                            Last updated by</dt>
                        <dd class="govuk-summary-list__value"> Nathan TOWNSEND <span class="govuk-!-margin-left-2">21
                                November
                                12:24pm</span>
                        </dd>
                    </div>
                    <div class="govuk-summary-list__row">
                        <dt class="govuk-summary-list__key">
                            Core provider data version to upload against
                        </dt>
                        <dd class="govuk-summary-list__value"> 21 August 2021 - Initial providers
                        </dd>
                    </div>

                </dl>
            </div>
            <div class="govuk-grid-column-two-thirds govuk-!-margin-top-2">

                <div class="govuk-form-group">
                    <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
                        <label class="govuk-label" for="file-upload-1">
                            Select update type
                        </label>
                    </legend>
                    <div class="govuk-radios">
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="updateTypeMerge" name="updateType"
                                onclick="updateTypeCheck().document.getElementById('emptyCells').classList.add('govuk-visually-hidden')"
                                type="radio" value="merge/merge-in-progress">
                            <label class="govuk-label govuk-radios__label" for="changed-name">
                                Merge existing version
                            </label>
                            <div id="merge" class="govuk-hint govuk-radios__hint">
                                Combine a new data source with the existing file
                            </div>
                        </div>
                        <div class="govuk-radios__item govuk-!-margin-bottom-7">
                            <input class="govuk-radios__input" id="updateTypeReplace"
                                onclick="updateTypeCheck().document.getElementById('emptyCells').classList.remove('govuk-visually-hidden')"
                                name="updateType" type="radio" value="/v1/datasets/manageDatasets">
                            <label class="govuk-label govuk-radios__label" for="changed-name-2">
                                Create new version
                            </label>
                            <div id="create-new" class="govuk-hint govuk-radios__hint">
                                Replace the existing data source with a new file
                            </div>
                        </div>
                    </div>
                </div>


                <div class="govuk-form-group govuk-visually-hidden" id="emptyCells">
                    <fieldset class="govuk-fieldset" aria-describedby="sign-in-hint">

                        <label class="govuk-label" for="emptyCellQuestion">
                            Do you want to treat empty cells as values when updating providers?
                        </label>
                        <div class="govuk-radios govuk-!-margin-top-4">
                            <div class="govuk-radios__item">
                                <input class="govuk-radios__input" id="emptyCellQuestion" name="emptyCell" type="radio"
                                    value="government-gateway" aria-describedby="sign-in-item-hint"
                                    onchange="getEmptyCell()">
                                <label class="govuk-label govuk-radios__label" for="sign-in">
                                    Yes </label>
                                <div id="sign-in-item-hint" class="govuk-hint govuk-radios__hint">
                                    Allow an empty cell to replace an existing previous value

                                </div>
                            </div>
                            <div class="govuk-radios__item">
                                <input class="govuk-radios__input" id="sign-in-2" name="emptyCell" type="radio"
                                    value="govuk-verify" aria-describedby="sign-in-2-item-hint">
                                <label class="govuk-label govuk-radios__label" for="sign-in-2">
                                    No </label>
                                <div id="sign-in-2-item-hint" class="govuk-hint govuk-radios__hint">
                                    Ignore any empty cells in the file upload

                                </div>
                            </div>
                        </div>

                    </fieldset>
                </div>

                <div class="govuk-form-group">
                    <label class="govuk-label" for="file-upload-1">
                        Select data source file
                    </label>
                    <input class="govuk-file-upload" id="file-upload-1" name="file-upload" type="file">
                </div>

                <div class="govuk-form-group">
                    <label class="govuk-label" for="more-detail">
                        Description
                    </label>
                    <span id="more-detail-hint" class="govuk-hint">
                    </span>
                    <textarea class="govuk-textarea" id="file-description" name="description" rows="5"
                        aria-describedby="more-detail-hint">{{ data['data-more-detail'] }}</textarea>
                </div>

                <div class="govuk-form-group">
                    <label class="govuk-label" for="change-note">
                        Change note
                    </label>
                    <span id="more-detail-hint" class="govuk-hint">
                    </span>
                    <textarea class="govuk-textarea" id="more-detail" name="change-note-data" rows="5"
                        aria-describedby="more-detail-hint"></textarea>
                </div>
                <button class="govuk-button govuk-!-margin-right-1" data-module="govuk-button">
                    Save
                </button>
                <button class="govuk-button govuk-button--secondary" data-module="govuk-button">
                    Cancel
                </button>
        </fieldset>
</div>
</form>
</div>
</div>

<script>
    function updateTypeCheck() {
        console.log("updateTypeCheck ran")
        var updateType = document.getElementsByName('updateType');
        for (var i = 0, length = updateType.length; i < length; i++) {
            if (updateType[i].checked) {
                // do whatever you want with the checked radio
                document.getElementById('updateDataset').action = updateType[i].value;
                // only one radio can be logically checked, don't check the rest
                break;
            }
        }
    }
    function getEmptyCell() {
        var coreProviderData = document.getElementById("coreProviderData").value;
        console.log(coreProviderData)
        sessionStorage.setItem('provider data changed', coreProviderData);

    }

</script>

<script type="application/json" id="update-data-source">
    {
       
        "updateType": {
            "presence": {
                "message": "^Select update type"
            }
        }, 

      
        "file-upload": {
            "presence": {
                "message": "^Select a data source file"
            }
        },
        
        "description": {
            "presence": {
                "message": "^Enter a description"
            }
        },
       

        "change-note-data": {
            "presence": {
                "message": "^Enter a change note"
            }
        }

    }
</script>
<!--  "emptyCell": {
            "presence": {
                "message": "^Select how empty cells are treated"
            }
        }, -->

{% endblock %}